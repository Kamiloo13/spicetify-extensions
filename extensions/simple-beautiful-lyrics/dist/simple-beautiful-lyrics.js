(async()=>{for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));var R=Object.create,s=Object.defineProperty,P=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,M=Object.getPrototypeOf,H=Object.prototype.hasOwnProperty,e=(e,t,a)=>(a=null!=e?R(M(e)):{},((t,a,i,r)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let e of n(a))H.call(t,e)||e===i||s(t,e,{get:()=>a[e],enumerable:!(r=P(a,e))||r.enumerable});return t})(!t&&e&&e.__esModule?a:s(a,"default",{value:e,enumerable:!0}),e)),V=(t=(e,t)=>function(){return t||(0,e[n(e)[0]])((t={exports:{}}).exports,t),t.exports})({"external-global-plugin:react"(e,t){t.exports=Spicetify.React}}),t=t({"external-global-plugin:react-dom"(e,t){t.exports=Spicetify.ReactDOM}}),a=class{constructor(){this.tasks=[],this.subCleanups=[]}AddTask(e,t){t&&this.Clean(t),this.tasks.push({id:t,task:e})}AddSubCleanup(e,t){return this.subCleanups.push({instance:e,id:t}),e}AddObserver(e,t){return this.AddTask(e.disconnect.bind(e),t),e}AddHtml(e,t){return this.AddTask(()=>{e.remove()},t),e}Clean(t){t?(this.tasks=this.tasks.filter(e=>e.id!==t||(e.task(),!1)),this.subCleanups=this.subCleanups.filter(e=>e.id!==t||(e.instance.Clean(),!1))):(this.tasks.forEach(e=>{e.task()}),this.subCleanups.forEach(e=>{e.instance.Clean()}),this.tasks=[])}},i=new a,r=!1;{let e,t;for(var o of document.getElementsByTagName("script"))o.src.includes("simple-beautiful-lyrics.js")&&(o.src.startsWith("https://xpui.app.spotify.com/")?void 0===t?t=o:o.remove():void 0===e?e=o:o.remove());void 0===t?e:(r=!0,void 0!==e&&e.remove(),t)}var l,c=!1,d=Spicetify.Player,u=Spicetify.showNotification,y=Spicetify.Platform,f=y?.History,m=Spicetify.Playbar,h=Spicetify.Snackbar,j=()=>{d=Spicetify.Player,u=Spicetify.showNotification,f=(y=Spicetify.Platform)?.History,m=Spicetify.Playbar,h=Spicetify.Snackbar,void 0!==d&&void 0!==u&&void 0!==y&&void 0!==f&&void 0!==m&&void 0!==h&&(c=!0)},z=class{constructor(){this.listeners=[]}Connect(e){return this.listeners.push(e),()=>this.Disconnect(e)}Disconnect(e){e=this.listeners.indexOf(e);-1<e&&this.listeners.splice(e,1)}Fire(){this.listeners.forEach(e=>e())}},p=new class{constructor(){this.SongChanged=new z,this.Started=!1}Start(){if(!0!==this.Started){this.Started=!0;let e=()=>{this.SongChanged.Fire()};d.addEventListener("songchange",e),i.AddTask(()=>d.removeEventListener("songchange",e)),void 0!==d.data&&e()}}},g=new z,b=new Map,W=(b.set("Default","brightness(0.5) saturate(2.5)"),b.set("SidePanel","brightness(1) saturate(2.25)"),()=>{var e=d.data.item.metadata,e={Large:e.image_xlarge_url,Big:e.image_large_url,Default:e.image_url,Small:e.image_small_url};e.Default!==l?.Default&&(l=e,g.Fire())}),$=()=>l,v=class{static findSetIndex(e){var t=v.ComponentClasses[e];for(let e=0;e<t.length;e++)if(document.body.querySelector("."+t[e]))return void(v.SetIndex=e)}static getComponent(e){return-1===v.SetIndex&&v.findSetIndex(e),document.body.querySelector("."+v.ComponentClasses[e][v.SetIndex])}static checkClassNamesMatch(e,t){-1===v.SetIndex&&v.findSetIndex(t);t=v.ComponentClasses[t][v.SetIndex];return e.contains(t)}},S=((b=v).ComponentClasses={FullScreenLyricsBackgroundClass:["lyrics-lyrics-background","o4GE4jG5_QICak2JK_bn","L9xhJOJnV2OL5Chm3Jew"],FullScreenLyricsContainerClass:["lyrics-lyrics-contentWrapper","_Wna90no0o0dta47Heiw","esRByMgBY3TiENAsbDHA"],SidebarLyricsBackgroundClass:["main-nowPlayingView-lyricsGradient","main-nowPlayingView-lyricsGradient","main-nowPlayingView-lyricsGradient"],LyricClass:["lyrics-lyricsContent-lyric","nw6rbs8R08fpPn7RWW2w","NiCdLCpp3o2z6nBrayOn"],UnsyncedLyricClass:["lyrics-lyricsContent-unsynced","SruqsAzX8rUtY2isUZDF","HxblHEsl2WX2yhubfVIc"],HighlightedLyricClass:["lyrics-lyricsContent-highlight","aeO5D7ulxy19q4qNBrkk","MEjuIn9iTBQbnCqHpkoQ"],ActiveLyricClass:["lyrics-lyricsContent-active","EhKgYshvOwpSrTv399Mw","arY01KDGhWNgzlAHlhpd"]},b.SetIndex=-1,b),q=["lyrics-background-color","lyrics-background-back","lyrics-background-back-center"],w=i.AddSubCleanup(new a,"LiveMainBackgrounds"),C=i.AddSubCleanup(new a,"LiveSidebarBackgrounds"),G=e=>{var t,a=w.AddHtml(document.createElement("div"));a.classList.add("lyrics-background-container");let i=[];for(t of q){var r=w.AddHtml(document.createElement("img"));r.classList.add(t),a.appendChild(r),i.push(r)}var s=()=>{var e,t=$()?.Default??"";for(e of i)e.src=t},s=(w.AddTask(g.Connect(s)),s(),()=>{e.classList.contains("lyrics-background")||e.classList.add("lyrics-background")});s(),w.AddObserver(new MutationObserver(s)).observe(e,{attributes:!0,attributeFilter:["class"],childList:!1,subtree:!1}),e.prepend(a),w.AddTask(()=>e.classList.remove("lyrics-background"))},J=e=>{var t,a=C.AddHtml(document.createElement("div"));a.classList.add("lyrics-background-container"),a.style.zIndex="-1";let i=[];for(t of q){var r=C.AddHtml(document.createElement("img"));r.classList.add(t),a.appendChild(r),i.push(r)}var s=()=>{var e,t=$()?.Default??"";for(e of i)e.src=t},s=(C.AddTask(g.Connect(s)),s(),()=>{e.classList.contains("lyrics-background")||e.classList.add("lyrics-background")});e.style.position="relative",s(),C.AddObserver(new MutationObserver(s)).observe(e,{attributes:!0,attributeFilter:["class"],childList:!1,subtree:!1}),e.prepend(a),C.AddTask(()=>{e.classList.remove("lyrics-background"),e.style.position=""})},k=null,L=null,U=()=>{var e=S.getComponent("FullScreenLyricsBackgroundClass");k!==e&&(null===e?(k=null,w.Clean()):((k=e).style.background="linear-gradient(90deg, #0a0a0a8a, #0000)",G(e?.parentElement?.parentElement?.parentElement?.parentElement?.parentElement?.parentElement?.querySelector(".under-main-view"))))},Y=()=>{var e=S.getComponent("SidebarLyricsBackgroundClass");L!==e&&(null===e?(L=null,C.Clean()):J(L=e))},K=()=>{U(),Y()},x=[],X=function(e,t){return e=setTimeout(()=>{t()},1e3*e),x.push(e),function(e){clearTimeout(e);e=x.indexOf(e);-1<e&&x.splice(e,1)}.bind(null,e)},Q=4,Z=.5,ee=.25,te=.005,E=i.AddSubCleanup(new a,"Lyrics"),ae=r=>{let n=new Map,s=0,o=(e,t)=>{e.style.fontSize="Active"==t.State?s+Z+"rem":""},e=()=>{let t=0;for(var[e,a]of n){e=e.classList;S.checkClassNamesMatch(e,"ActiveLyricClass")?(a.State="Active",t=a.LayoutOrder):S.checkClassNamesMatch(e,"UnsyncedLyricClass")?a.State="Unsynced":S.checkClassNamesMatch(e,"HighlightedLyricClass")?a.State="Sung":a.State="Unsung"}for(var[i,r]of n){var s="Active"===r.State||"Unsynced"===r.State;let e;e=s||t<=1?0:Math.min(Math.abs(r.LayoutOrder-t),Q);s=s?"var(--lyrics-color-active)":"Sung"===r.State?"var(--lyrics-color-passed)":"var(--lyrics-color-inactive)";o(i,r),i.style.color="transparent",i.style.textShadow=`0 0 ${e}px `+s}},t=()=>{var e,t,a=getComputedStyle(r),i=getComputedStyle(document.documentElement),a=parseFloat(a.fontSize),i=parseFloat(i.fontSize);s=a/i;for([e,t]of n)o(e,t)};var a,i,l;for(a of r.childNodes)a instanceof HTMLDivElement&&S.checkClassNamesMatch(a.classList,"LyricClass")&&(i=a,l=void 0,l=Array.from(r.children).indexOf(i),E.AddObserver(new MutationObserver(()=>E.AddTask(X(te,e),"LyricUpdate"))).observe(i,{attributes:!0,attributeFilter:["class"],childList:!1,subtree:!1}),n.set(i,{LayoutOrder:l,State:"Unsung"}));E.AddObserver(new ResizeObserver(()=>E.AddTask(X(ee,t),"ContainerResize"))).observe(document.body),t(),e()},N=null,ie=()=>{var e=S.getComponent("FullScreenLyricsContainerClass");N!==e&&(N=null,E.Clean(),e)&&ae(N=e)},O=e(V()),re=e(t()),se=class{constructor(e,t){this.name=e,this.settingsId=t,this.settingsFields={},this.setRerender=null,this.pushSettings=async()=>{for(Object.entries(this.settingsFields).forEach(([e,t])=>{"button"!==t.type&&void 0===this.getFieldValue(e)&&this.setFieldValue(e,t.defaultValue)});!Spicetify?.Platform?.History?.listen;)await new Promise(e=>setTimeout(e,100));this.stopHistoryListener&&this.stopHistoryListener(),this.stopHistoryListener=Spicetify.Platform.History.listen(e=>{"/preferences"===e.pathname&&this.render()}),"/preferences"===Spicetify.Platform.History.location.pathname&&await this.render()},this.rerender=()=>{this.setRerender&&this.setRerender(Math.random())},this.render=async()=>{for(;!document.getElementById("desktop.settings.selectLanguage");){if("/preferences"!==Spicetify.Platform.History.location.pathname)return;await new Promise(e=>setTimeout(e,100))}var e=document.querySelector(".main-view-container__scroll-node-child main div");if(!e)return console.error("[spcr-settings] settings container not found");let t=Array.from(e.children).find(e=>e.id===this.settingsId);t?console.log(t):((t=document.createElement("div")).id=this.settingsId,e.appendChild(t)),re.default.render(O.default.createElement(this.FieldsContainer,null),t)},this.addButton=(e,t,a,i)=>{this.settingsFields[e]={type:"button",description:t,value:a,events:{onClick:i}}},this.addToggle=(e,t,a,i)=>{this.settingsFields[e]={type:"toggle",description:t,defaultValue:a,events:{onChange:i}}},this.getFieldValue=e=>JSON.parse(Spicetify.LocalStorage.get(this.settingsId+"."+e)||"{}")?.value,this.setFieldValue=(e,t)=>{Spicetify.LocalStorage.set(this.settingsId+"."+e,JSON.stringify({value:t}))},this.FieldsContainer=()=>{var[e,t]=(0,O.useState)(0);return this.setRerender=t,O.default.createElement("div",{className:"x-settings-section",key:e},O.default.createElement("h2",{className:"e-9640-text encore-text-body-medium-bold encore-internal-color-text-base"},this.name),Object.entries(this.settingsFields).map(([e,t])=>O.default.createElement(this.Field,{nameId:e,field:t})))},this.Field=a=>{var e=this.settingsId+"."+a.nameId;let t,[i,r]=(t="button"===a.field.type?a.field.value:this.getFieldValue(a.nameId),(0,O.useState)(t)),s=e=>{void 0!==e&&(r(e),this.setFieldValue(a.nameId,e))};return O.default.createElement("div",{className:"x-settings-row"},O.default.createElement("div",{className:"x-settings-firstColumn"},O.default.createElement("label",{className:"e-9640-text encore-text-body-small encore-internal-color-text-subdued",htmlFor:e},a.field.description||"")),O.default.createElement("div",{className:"x-settings-secondColumn"},"button"===a.field.type?O.default.createElement("span",null,O.default.createElement("button",{id:e,className:"Button-sc-y0gtbx-0 Button-buttonSecondary-small-useBrowserDefaultFocusStyle encore-text-body-small-bold e-9640-button--small x-settings-button",...a.field.events,onClick:e=>{s();var t=a.field.events?.onClick;t&&t(e)},type:"button"},i)):"toggle"===a.field.type?O.default.createElement("label",{className:"x-toggle-wrapper"},O.default.createElement("input",{id:e,className:"x-toggle-input",type:"checkbox",checked:i,...a.field.events,onClick:e=>{s(e.currentTarget.checked);var t=a.field.events?.onClick;t&&t(e)}}),O.default.createElement("span",{className:"x-toggle-indicatorWrapper"},O.default.createElement("span",{className:"x-toggle-indicator"}))):O.default.createElement(O.default.Fragment,null)))}}},ne=!1,oe=e=>{ne=e},A=(...e)=>ne&&console.log("[SBL]:",...e),B=window.fetch,le=100,T="simple-beautiful-lyrics:cache-lyrics",F=[],_=0,D=0,ce=()=>{_>Number.MAX_SAFE_INTEGER-1001&&(_=0),Number.MAX_SAFE_INTEGER-1002<D&&(D=0)},de=async e=>{for(var t=Date.now();D<e;){if(7500<Date.now()-t)throw new Error("Timeout in waitForTurn");await new Promise(e=>setTimeout(e,100))}},ue=()=>{Spicetify.LocalStorage.set(T,JSON.stringify(F)),A("Lyrics Data Bank saved to cache")},I=t=>{F.find(e=>e.canonical_id===t.canonical_id)?A(`Lyrics already exist in 'bank' <${t.canonical_id}>`):(F.length>=le&&(F.shift(),A("Lyrics Data Bank overflowed, removing oldest entry")),F.push(t),ue())},ye=()=>{F.length=0,Spicetify.LocalStorage.remove(T),A("Lyrics Data Bank cleared")},fe=()=>{var e=Spicetify.LocalStorage.get(T);if(e)try{F.length=0,F.push(...JSON.parse(e)),A("Lyrics Data Bank loaded from cache")}catch(e){console.error("[SBL]: Error while parsing cached data",e),ye()}},me=async(...a)=>{var e=a[0];if("string"==typeof e){if(e.startsWith("https://spclient.wg.spotify.com/color-lyrics/v2/track/")){let t=e.split("/").at(6);if(t){ce();try{await de(_++)}catch(e){return console.error("[SBL]:",e),D++,B(...a)}var i=F.find(e=>e.canonical_id===t);if(D++,i&&i.data)return A(`Lyrics found in 'bank' <${t}>`),new Response(JSON.stringify(i.data),{status:200,statusText:"OK",headers:new Headers({"Content-Type":"application/json"})});A(`Lyrics not found in 'bank' <${t}>`)}else console.error("[SBL]: Canonical ID not found in 'color-lyrics' fetch");return B(...a)}if(e.startsWith("https://spclient.wg.spotify.com/metadata/4/track/")){let t=e.split("/").at(6)?.split("?").at(0);if(!t)return console.error("[SBL]: GID not found in 'metadata' fetch"),B(...a);ce();try{await de(_++)}catch(e){return console.error("[SBL]:",e),D++,B(...a)}var i=F.find(e=>e.gid===t);if(i)return D++,i.data?(A(`Lyrics found in 'bank' when fetching for 'metadata' <${t}>`),(i=await(e=await B(...a)).clone().json()).has_lyrics=!0,new Response(JSON.stringify(i),{status:e.status,statusText:e.statusText,headers:e.headers})):(A(`Lyrics found in 'bank' but no lyrics were available when fetching for 'metadata' <${t}>`),B(...a));var i=await B(...a),e=await i.clone().json(),r=e.canonical_uri.split(":").at(-1);if(e.has_lyrics)return A(`Lyrics found in 'metadata' <${t}>`),I({gid:t,canonical_id:r}),D++,i;var s=await B(`https://lyrics.kamiloo13.me/api/get?artist=${e.artist[0].name}&track=${e.name}&duration=${Math.round(e.duration/1e3)}&album=`+e.album.name).catch(()=>null),n=await s?.json().catch(()=>null);if(D++,!n||!s?.ok)return A(`Lyrics NOT found in 'lyrics.kamiloo13.me' <${t}>`),I({gid:t,canonical_id:r}),i;A(`Lyrics found in 'lyrics.kamiloo13.me' <${t}>`);s={colors:{background:0,highlightText:0,text:0},hasVocalRemoval:!1,lyrics:{alternatives:[],capStatus:"NONE",isDenseTypeface:!1,isRtlLanguage:!1,isSnippet:!1,language:e.language_of_performance[0],lines:n.lines,previewLines:n.lines.slice(0,5),provider:n.provider,providerLyricsDisplayName:n.providerLyricsDisplayName,providerLyricsId:n.providerLyricsId,syncLyricsUri:"",syncType:n.isSynced?"LINE_SYNCED":"UNSYNCED"}};return I({gid:t,canonical_id:r,data:s}),e.has_lyrics=!0,new Response(JSON.stringify(e),{status:i.status,statusText:i.statusText,headers:i.headers})}}return B(...a)},he=e=>{window.fetch=e?me:B,A("Fetch override is now "+(e?"enabled":"disabled")),A(`Lyrics Data Bank had ${F.length} entries`,F),e?(fe(),D=_=0,A("Request count: "+_),A("Current request ID: "+D)):(F.length=0,A("Request count: "+_),A("Current request ID: "+D),_=Number.MAX_SAFE_INTEGER-1e3,D=Number.MAX_SAFE_INTEGER-1e3),A(`Lyrics Data Bank has now ${F.length} entries`,F)},pe=async function(){if(!r){let t=new se("Simple Beautiful Lyrics","simple-beautiful-lyrics");for(t.addToggle("override-fetch","Override Spotify's 'fetch' function to enable searching for alternative lyric sources (app refresh recommended)",!0,()=>{var e=Boolean(t.getFieldValue("override-fetch"));he(e)}),t.addToggle("enable-debug","Enable debug logging",!1,()=>{oe(Boolean(t.getFieldValue("enable-debug")))}),t.addButton("clear-cache","Clear Lyrics Cache","Clear",()=>{ye(),Spicetify.showNotification("Lyrics cache cleared!")}),t.pushSettings(),oe(Boolean(t.getFieldValue("enable-debug"))),he(Boolean(t.getFieldValue("override-fetch")));!c&&!j();)await new Promise(e=>setTimeout(e,100));i.AddTask(p.SongChanged.Connect(W)),W(),p.Start();i.AddObserver(new MutationObserver(()=>{K(),ie()})).observe(document.body,{attributes:!1,childList:!0,subtree:!0});var e=document.querySelector("#lyrics-cinema");e?.style.setProperty("grid-area","main-view / main-view / main-view / right-sidebar"),e?.style.setProperty("overflow","hidden"),K(),i.AddTask(p.SongChanged.Connect(()=>N=null)),ie()}};(async()=>{await pe()})(),(async()=>{var e;document.getElementById("simpleDbeautifulDlyrics")||((e=document.createElement("style")).id="simpleDbeautifulDlyrics",e.textContent=String.raw`
  .lyrics-lyricsContent-lyric:hover{text-shadow:0 0 0 var(--lyrics-color-active)!important}.lyrics-lyricsContent-lyric{--lyrics-color-inactive:rgb(240 240 240 / 51%)!important}.nw6rbs8R08fpPn7RWW2w:hover{text-shadow:0 0 0 var(--lyrics-color-active)!important}.nw6rbs8R08fpPn7RWW2w{--lyrics-color-inactive:rgb(240 240 240 / 51%)!important}.NiCdLCpp3o2z6nBrayOn:hover{text-shadow:0 0 0 var(--lyrics-color-active)!important}.NiCdLCpp3o2z6nBrayOn{--lyrics-color-inactive:rgb(240 240 240 / 51%)!important}.lyrics-lyricsContent-active{margin-top:.25em;margin-bottom:.25em}.EhKgYshvOwpSrTv399Mw{margin-top:.25em;margin-bottom:.25em}.arY01KDGhWNgzlAHlhpd{margin-top:.25em;margin-bottom:.25em}.Root__main-view:has(.lyrics-background) .os-scrollbar,.os-host:has(.lyrics-background) .os-scrollbar{padding:5px}.Root__main-view:has(.lyrics-background) .os-scrollbar .os-scrollbar-handle,.os-host:has(.lyrics-background) .os-scrollbar .os-scrollbar-handle{mix-blend-mode:overlay;background-color:rgba(252,249,249,.117)!important}.lyrics-background{overflow:hidden;position:static}.lyrics-background-container{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;overflow:hidden;filter:saturate(1.5) brightness(.8)}.lyrics-background-back,.lyrics-background-back-center,.lyrics-background-color{position:absolute;width:200%;animation:rotate 35s linear infinite;filter:blur(40px);border-radius:100em}.lyrics-background-color{right:0;top:0;z-index:10}.lyrics-background-back{left:0;bottom:0;z-index:1;animation-direction:reverse}.lyrics-background-back-center{z-index:0;width:300%;right:-50%;top:-20%;animation-direction:reverse}@keyframes rotate{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}:root{--beautiful-lyrics-random-degree:258deg}@keyframes rotate{0%{transform:rotate(var(--beautiful-lyrics-random-degree))}100%{transform:rotate(calc(var(--beautiful-lyrics-random-degree) + 360deg))}}@font-face{font-family:BeautifulLyrics;font-weight:400;src:url(https://fonts.socalifornian.live/LyricsRegular.woff2) format("woff2")}@font-face{font-family:BeautifulLyrics;font-weight:500;src:url(https://fonts.socalifornian.live/LyricsMedium.woff2) format("woff2")}@font-face{font-family:BeautifulLyrics;font-weight:600;src:url(https://fonts.socalifornian.live/LyricsSemibold.woff2) format("woff2")}@font-face{font-family:BeautifulLyrics;font-weight:700;src:url(https://fonts.socalifornian.live/LyricsBold.woff2) format("woff2")}.main-nowPlayingView-lyricsContent .lyrics-lyricsContent-lyric{font-weight:700}.lyrics-lyricsContent-lyric:hover{text-decoration:none!important}.lyrics-lyricsContent-text{font-family:BeautifulLyrics,var(--encore-body-font-stack, var(--fallback-fonts, sans-serif)),sans-serif!important}
      `.trim(),document.head.appendChild(e))})()})();